<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<div th:replace="~{usr/include/head :: head}"></div>

    <!-- Checkout Page Start -->
    <div class="container-fluid py-5">
        <div class="container py-5 mt-5">
            <h1 class="mb-4 mt-5">결제</h1>


            <form action="#">
                <div class="row g-5">



                    <div class="col">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">메뉴</th>
                                        <th scope="col" class="text-center">메뉴명</th>
                                        <th scope="col" class="text-center">가격</th>
                                        <th scope="col" class="text-center">개수</th>
                                        <th scope="col" class="text-center">합계</th>
                                        <th scope="col" class="text-center">취소</th>
                                    </tr>
                                </thead>
                                <tbody id="tbody">
                                
                                    <tr class="item-row" th:each="item : ${list}">
                                        <td scope="row">
                                        	<input type="hidden" th:value="${item.seq}">
                                            <div class="d-flex align-items-center mt-2">
                                                <img th:src="${item.menuImg}"
                                                    class="img-fluid rounded-circle" style="width: 90px; height: 90px;"
                                                    alt="">
                                            </div>
                                        </td>
                                        <td class="py-5 text-center" th:text="${item.menuNm}"></td>
                                        <td class="py-5 text-center" th:text="${item.price} + 원"></td>
                                        
                                        <td class="text-center align-middle">
	                                        <div class="input-group mx-auto text-center" style="width: 100px;">
	                                          <div class="input-group-btn">
								                <button type="button" class="btn btn-sm btn-minus rounded-circle bg-light border">
								                  <i class="fa fa-minus"></i>
								                </button>
								              </div>
								              <input type="text" style="background-color:#FFFFFF;" class="form-control form-control-sm text-center border-0 item-qty" th:value="${item.quantity}" readonly>
								              <div class="input-group-btn">
								                <button type="button" class="btn btn-sm btn-plus rounded-circle bg-light border">
								                  <i class="fa fa-plus"></i>
								                </button>
								              </div>
								            </div>
                                        </td>
                                        
                                        <td class="py-5 text-center item-total" th:value="${item.price * item.quantity}" th:text="${item.price * item.quantity} + 원"></td>
                                    	<td class="text-center align-middle">
                                    		<button type="button" class="btn btn-md rounded-circle bg-light border btn-delete">
                                    			<i class="fa fa-times text-danger"></i>
                                    		</button>
                                    	</td>
                                    </tr>
                                    
                                </tbody>
                                
                                <tfoot>
                                	<tr>
                                        <td class="py-5"></td>
                                        <td class="py-5"></td>
                                        <td class="py-5"></td>
                                        <td class="py-5"></td>
                                        <td class="py-5">
                                            <p class="mb-0 text-dark text-uppercase py-3">TOTAL</p>
                                        </td>
                                        <td class="py-5">
                                            <div class="py-3 border-bottom border-top">
                                                <p class="mb-0 text-dark total-sum">원</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tfoot>
                                
                            </table>
                        </div>




                        <div class="row g-4 justify-content-end pt-4">
                        
                            <div class="col-12 col-md-3 order-2 order-md-1">
                                <a href="/TableOrder/shopList"
                                    class="btn border-secondary py-3 px-4 text-uppercase w-100 text-primary">
                                    <i class="vc_btn3-icon fas fa-arrow-left pe-2"></i>
                                    뒤로가기
                                </a>
                            </div>
                            <div class="col-12 col-md-3 order-1 order-md-2">
                                <button type="button" class="btn btn-primary py-3 px-4 text-uppercase w-100 text-white"
                                    data-bs-toggle="modal" data-bs-target="#checkoutModal">
                                    결제
                                </button>
                            </div>
                            
                        </div>
                        
                        <!-- Modal Start-->
                        <div class="modal fade" id="checkoutModal" data-bs-backdrop="static"
                            data-bs-keyboard="false" tabindex="-1" aria-labelledby="checkoutModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="checkoutModalLabel">결제 완료</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        결제 완료.
                                    </div>
                                    <div class="modal-footer">
                                        <a href="/TableOrder/ordersDetail" class="btn btn-primary">확인</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Modal End -->
                        
                        
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Checkout Page End -->
    
    <script>
    	
    	document.addEventListener("DOMContentLoaded", function(){
    	    document.getElementById("tbody").addEventListener("click", function(e) {
    	        // 수량 증가
    	        if (e.target.closest(".btn-plus")) {
    	            const row = e.target.closest(".item-row");
    	            const qtyInput = row.querySelector(".item-qty");
    	            let quantity = parseInt(qtyInput.value);
    	            qtyInput.value = ++quantity;
    	            updateItemTotal(row);
    	            updateTotalSum();
    	        }

    	        // 수량 감소
    	        if (e.target.closest(".btn-minus")) {
    	            const row = e.target.closest(".item-row");
    	            const qtyInput = row.querySelector(".item-qty");
    	            let quantity = parseInt(qtyInput.value);
    	            if (quantity > 1) {
    	                qtyInput.value = --quantity;
    	                updateItemTotal(row);
    	            }
    	            updateTotalSum();
    	        }
    	    });

    	    function updateItemTotal(row) {
    	        const priceText = row.querySelector("td:nth-child(3)").innerText.replace("원", "").trim(); // 3번째 <td>
    	        const quantity = parseInt(row.querySelector(".item-qty").value);
    	        const totalTd = row.querySelector(".item-total");

    	        const price = parseInt(priceText);
    	        const total = price * quantity;

    	        totalTd.textContent = total + "원";
    	    }

    	    updateTotalSum();
    	});
    	
    	// 개별 주문 삭제
    	document.getElementById("tbody").addEventListener("click", function(e) {
    		if(e.target.closest(".btn-delete")) {
				const row = e.target.closest(".item-row");
				if(row){
					row.remove();
					updateTotalSum();
				}
    		}
    	});
    	
    	// 총합 계산
    	function updateTotalSum(){
    		let sum = 0;
    		
    		document.querySelectorAll(".item-row").forEach(function(row) {
    			
    	        const totalCell = row.querySelector(".item-total");
    	        const text = totalCell.textContent.replace("원", "").trim();
    	        const number = parseInt(text.replace(/,/g, ""));
    	        sum += number;
    			
        	});
    		
    		document.querySelector(".total-sum").textContent = sum.toLocaleString() + " 원";
    	}
    	
    	
    
    </script>

<div th:replace="~{usr/include/footer :: footer}"></div>